<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ParaBank – Assisted Start</title>

<style>
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background:#fff;
  margin:40px;
}

.card {
  max-width:560px;
  padding:26px;
  border:1px solid #ddd;
  border-radius:14px;
}

h1 { font-size:18px; margin:0 0 10px; }
p { margin:0 0 14px; color:#333; }

.btn {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #111;
  background:#fff;
  cursor:pointer;
  font-size:14px;
}
.btn + .btn { margin-top:10px; }

.helper {
  margin-top:10px;
  font-size:12px;
  color:#666;
}

.badge {
  font-size:12px;
  padding:2px 8px;
  border:1px solid #ddd;
  border-radius:999px;
  margin-left:6px;
}

.overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  z-index:9999;
}

.spotlight {
  position:absolute;
  border:3px solid #3b82f6;
  border-radius:10px;
  pointer-events:none;
}

.pop {
  position:fixed;
  background:#fff;
  border-radius:12px;
  border:1px solid #ddd;
  padding:14px;
  width:320px;
  z-index:10000;
}

.pop h2 { margin:0 0 6px; font-size:14px; }
.pop p { font-size:13px; margin:0 0 10px; }

.actions {
  display:flex;
  justify-content:flex-end;
  gap:8px;
}

.small {
  font-size:12px;
  color:#666;
  margin-top:8px;
}
</style>
</head>

<body>
<div class="card">
  <h1>ParaBank Assisted Signup <span class="badge">in-session start</span></h1>
  <p>Choose how you want to begin:</p>

  <button class="btn" id="startSignup">Start signup</button>
  <button class="btn" id="startShare">Continue with screen share</button>

  <div class="helper">We’ll guide you in 2 quick clicks.</div>
</div>

<div class="overlay" id="overlay">
  <div class="spotlight" id="spotlight"></div>
</div>

<div class="pop" id="pop" style="display:none;">
  <h2 id="stepTitle"></h2>
  <p id="stepText"></p>
  <div class="actions">
    <button id="exit">Exit</button>
    <button id="next">Next</button>
  </div>
  <div class="small">You can keep this open while clicking.</div>
</div>

<script>
const PARABANK_URL = "https://parabank.parasoft.com/parabank/register.htm";
const overlay = document.getElementById("overlay");
const spotlight = document.getElementById("spotlight");
const pop = document.getElementById("pop");
const stepTitle = document.getElementById("stepTitle");
const stepText = document.getElementById("stepText");

let step = null;

// ---------- element finders ----------
function findPlus() {
  return document.querySelector('.session-icon-button.tab-new');
}

function findShareVisible() {
  const el = document.querySelector('[aria-label="Share screen"]');
  if (!el) return null;
  const r = el.getBoundingClientRect();
  if (r.width === 0 || r.height === 0) return null;
  return el;
}

// ---------- spotlight ----------
function highlight(el) {
  const r = el.getBoundingClientRect();
  spotlight.style.top = `${r.top - 6}px`;
  spotlight.style.left = `${r.left - 6}px`;
  spotlight.style.width = `${r.width + 12}px`;
  spotlight.style.height = `${r.height + 12}px`;
}

// ---------- steps ----------
function showStep1() {
  step = 1;
  sessionStorage.setItem("wfStep", "1");

  stepTitle.textContent = "Step 1 of 2";
  stepText.textContent = "Click the + button to open the New tab panel.";

  overlay.style.display = "block";
  pop.style.display = "block";

  const poll = setInterval(() => {
    const plus = findPlus();
    if (plus) {
      highlight(plus);
      clearInterval(poll);
    }
  }, 200);
}

function showStep2() {
  step = 2;
  sessionStorage.setItem("wfStep", "2");

  stepTitle.textContent = "Step 2 of 2";
  stepText.textContent = "In the New tab panel, click Screen share next to the URL field.";

  const poll = setInterval(() => {
    const share = findShareVisible();
    if (share) {
      highlight(share);
      clearInterval(poll);
    }
  }, 200);
}

// ---------- controls ----------
document.getElementById("startSignup").onclick = () => {
  window.location.assign(PARABANK_URL);
};

document.getElementById("startShare").onclick = () => {
  sessionStorage.setItem("wfStep", "1");
  showStep1();
};

document.getElementById("next").onclick = () => {
  if (step === 1) showStep2();
  else closeFlow();
};

document.getElementById("exit").onclick = closeFlow;

function closeFlow() {
  overlay.style.display = "none";
  pop.style.display = "none";
  spotlight.style.width = "0";
  sessionStorage.removeItem("wfStep");
}

// ---------- restore ----------
const saved = sessionStorage.getItem("wfStep");
if (saved === "1") showStep1();
if (saved === "2") showStep2();
</script>
</body>
</html>
